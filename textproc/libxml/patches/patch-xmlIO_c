From bf43e8a888cbee75e13622fea8a722b9d166c437 Mon Sep 17 00:00:00 2001
From: Nick Wellnhofer <wellnhofer@aevum.de>
Date: Tue, 9 Jul 2024 12:29:53 +0200
Subject: [PATCH] io: Fix return value of xmlFileRead

From 8699ba234b5a1328f0f30ca739b8f1dbc90ccf5e Mon Sep 17 00:00:00 2001
From: Nick Wellnhofer <wellnhofer@aevum.de>
Date: Thu, 18 Jul 2024 01:54:22 +0200
Subject: [PATCH] io: Don't call getcwd in xmlParserGetDirectory

Index: xmlIO.c
--- xmlIO.c.orig
+++ xmlIO.c
@@ -776,7 +776,7 @@ xmlFileRead(void * context, char * buffer, int len) {
     if ((bytes < (size_t) len) && (ferror(file)))
         return(-xmlIOErr(0, "fread()"));
 
-    return(len);
+    return(bytes);
 }
 
 #ifdef LIBXML_OUTPUT_ENABLED
@@ -2904,10 +2904,7 @@ xmlParserGetDirectory(const char *filename) {
 	else *cur = 0;
 	ret = xmlMemStrdup(dir);
     } else {
-        if (getcwd(dir, 1024) != NULL) {
-	    dir[1023] = 0;
-	    ret = xmlMemStrdup(dir);
-	}
+        ret = xmlMemStrdup(".");
     }
     return(ret);
 #undef IS_XMLPGD_SEP
