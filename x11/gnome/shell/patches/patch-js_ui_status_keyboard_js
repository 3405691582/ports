https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=235009

2nd chunk:
From 04aaa4b67bffbfe6d472e7f25c8e892f43151ed2 Mon Sep 17 00:00:00 2001
From: Carlos Garnacho <carlosg@gnome.org>
Date: Mon, 3 Jul 2023 11:44:17 +0200
Subject: [PATCH] keyboard: Spawn "tecla" to show keyboard map

Index: js/ui/status/keyboard.js
--- js/ui/status/keyboard.js.orig
+++ js/ui/status/keyboard.js
@@ -244,6 +244,19 @@ var InputSourceSystemSettings = class extends InputSou
                 id += `+${variants[i]}`;
             sourcesList.push({ type: INPUT_SOURCE_TYPE_XKB, id });
         }
+
+        // fallback: retrieve input source from current locale if we don't
+        // support the org.freedesktop.locale1 interface
+        if (sourcesList.length == 0) {
+            let _keyboardManagerLayout = KeyboardManager.getKeyboardManager()._getLocaleLayout();
+            if (_keyboardManagerLayout) {
+                let _kMLid = _keyboardManagerLayout.layout;
+                if (!!_keyboardManagerLayout.variant)
+                    _kMLid = _kMLid + '+' + _keyboardManagerLayout.variant;
+                sourcesList.push({ type: INPUT_SOURCE_TYPE_XKB, id: _kMLid });
+            }
+        }
+
         return sourcesList;
     }
 
@@ -1092,6 +1105,6 @@ class InputSourceIndicator extends PanelMenu.Button {
         if (xkbVariant.length > 0)
             description = `${description}\t${xkbVariant}`;
 
-        Util.spawn(['gkbd-keyboard-display', '-l', description]);
+        Util.spawn(['tecla', description]);
     }
 });
