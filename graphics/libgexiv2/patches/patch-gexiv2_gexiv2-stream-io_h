From 06adc8fb70cb8c77c0cd364195d8251811106ef8 Mon Sep 17 00:00:00 2001
From: Jens Georg <mail@jensge.org>
Date: Sat, 6 May 2023 10:47:32 +0000
Subject: [PATCH] Fix compatibility with exiv2 main branch

XXX -42,17: local patch (to be investigated)

Index: gexiv2/gexiv2-stream-io.h
--- gexiv2/gexiv2-stream-io.h.orig
+++ gexiv2/gexiv2-stream-io.h
@@ -24,10 +24,14 @@ class StreamIo : public Exiv2::BasicIo {
 public:
 #if EXIV2_TEST_VERSION(0,27,99)
     using ptr_type = Exiv2::BasicIo::UniquePtr;
-    using size_type = long;
+    using size_type = size_t;
+    using path_type = const std::string&;
+    using wpath_type = const std::wstring&;
 #else
     using ptr_type = Exiv2::BasicIo::AutoPtr;
     using size_type = long;
+    using path_type = std::string;
+    using wpath_type = std::wstring;
 #endif
 
 	StreamIo (ManagedStreamCallbacks* cb);
@@ -42,17 +46,28 @@ class StreamIo : public Exiv2::BasicIo {
     size_type read (Exiv2::byte* buf, size_type rcount) override;
 	int getb () override;
 	void transfer (Exiv2::BasicIo& src) override;
-	int seek (long offset, Position pos) override;
+	int seek (int64_t offset, Position pos) override;
 	Exiv2::byte* mmap (bool isWriteable = false) override;
 	int munmap () override;
-	long tell () const override;
-	size_t size () const override;
+    size_type tell() const override;
+    size_t size () const override;
 	bool isopen () const override;
 	int error () const override;
 	bool eof () const override;
-	std::string path () const override;
+#if EXIV2_TEST_VERSION(0, 27, 99)
+    void populateFakeData() override{};
+#endif
+#if EXIV2_TEST_VERSION(0, 27, 99)
+    const std::string& path() const noexcept override;
+#else
+    std::string path () const override;
+#endif
 #ifdef EXV_UNICODE_PATH
-	std::wstring wpath () const override;
+#if EXIV2_TEST_VERSION(0, 27, 99)
+    const std::wstring& wpath() const noexcept override;
+#else
+    std::wstring wpath() const override;
+#endif
 #endif
 	ptr_type temporary () const;
 
