From 9f0c481d1096d3a56894991cbf1d1e1bdb66c303 Mon Sep 17 00:00:00 2001
From: Ruslan Kabatsayev <b7.10110111@gmail.com>
Date: Sat, 8 Oct 2022 21:04:52 +0300
Subject: [PATCH] Add support for the versioned variant of ShowMySky library

Index: CMakeLists.txt
--- CMakeLists.txt.orig
+++ CMakeLists.txt
@@ -685,15 +685,33 @@ SET(CMAKE_AUTOUIC ON) # ?
 SET(CMAKE_INCLUDE_CURRENT_DIR ON)
 
 IF(ENABLE_SHOWMYSKY)
-    FIND_PACKAGE(ShowMySky REQUIRED)
-    ADD_DEFINITIONS(-DENABLE_SHOWMYSKY)
-    GET_TARGET_PROPERTY(ShowMySky_INCLUDE_DIRECTORIES ShowMySky::ShowMySky INTERFACE_INCLUDE_DIRECTORIES)
-    GET_TARGET_PROPERTY(ShowMySky_LIBRARY ShowMySky::ShowMySky LOCATION)
-    IF(EXISTS ${ShowMySky_LIBRARY})
-	MESSAGE(STATUS "Found ShowMySky library: ${ShowMySky_LIBRARY}")
-    ELSE()
-	MESSAGE(STATUS "Could NOT found ShowMySky library")
-    ENDIF()
+    FIND_PACKAGE(ShowMySky-Qt${QT_VERSION_MAJOR} QUIET)
+    IF(ShowMySky-Qt${QT_VERSION_MAJOR}_FOUND)
+         ADD_DEFINITIONS(-DENABLE_SHOWMYSKY)
+         GET_TARGET_PROPERTY(ShowMySky_INCLUDE_DIRECTORIES ShowMySky::ShowMySky INTERFACE_INCLUDE_DIRECTORIES)
+         GET_TARGET_PROPERTY(ShowMySky_LIBRARY ShowMySky::ShowMySky LOCATION)
+         IF(EXISTS ${ShowMySky_LIBRARY})
+             MESSAGE(STATUS "Found ShowMySky library: ${ShowMySky_LIBRARY}")
+         ELSE()
+             MESSAGE(STATUS "Could NOT found ShowMySky library")
+         ENDIF()
+    ELSE(ShowMySky-Qt${QT_VERSION_MAJOR}_FOUND)
+         # Try the legacy naming
+         FIND_PACKAGE(ShowMySky QUIET)
+         IF(ShowMySky_FOUND)
+             ADD_DEFINITIONS(-DENABLE_SHOWMYSKY)
+             GET_TARGET_PROPERTY(ShowMySky_INCLUDE_DIRECTORIES ShowMySky::ShowMySky INTERFACE_INCLUDE_DIRECTORIES)
+             GET_TARGET_PROPERTY(ShowMySky_LIBRARY ShowMySky::ShowMySky LOCATION)
+             IF(EXISTS ${ShowMySky_LIBRARY})
+                 MESSAGE(STATUS "Found ShowMySky library: ${ShowMySky_LIBRARY}")
+             ELSE()
+                 MESSAGE(STATUS "Could NOT found ShowMySky library")
+             ENDIF()
+         ELSE(ShowMySky_FOUND)
+             MESSAGE(WARNING "ShowMySky not found although you have selected to use it. \
+                              Make sure to add -DCMAKE_PREFIX_PATH=<CalcMySky_install>/CalcMySky/lib/ShowMySky")
+         ENDIF(ShowMySky_FOUND)
+    ENDIF(ShowMySky-Qt${QT_VERSION_MAJOR}_FOUND)
 ENDIF(ENABLE_SHOWMYSKY)
 
 IF(ENABLE_SCRIPTING)
